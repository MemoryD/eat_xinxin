# What to eat today

## 1 概述

本网站的目的是为了帮一些在每天饭点时不知道该吃什么的人做一个决定，灵感来源于自己每天对于吃什么这个问题的纠结。并且经过对身边人的调查，发现这并不是个别现象，而是一个还算比较普遍的现象 :cry: 。

因为实现要实现以上功能需要大量数据支持，所以目前的范围是在大学城内，并且开放数据添加，可以让用户添加数据以使数据库更完善。

[点击此处访问 What to eat today](http://111.230.51.214:8080)

## 2 开发环境

本网站采用 **Django ** 进行开发。Django 是用 Python 写的一个 Web 框架。

开发环境是 **Python 3.5.2**，**Django 1.10.6。**

服务器是 **Windows Server 2012R2 Standard 64bit**。



## 3 运行方式

将项目 `clone` 到本地，然后进入程序根目录，运行 `python runserver allow_host:port` 即可启动网站。其中的 `allow_host` 是允许访问此网站的 `ip` 地址，如果不填则默认只能本机访问，填 `0.0.0.0` 则表示任意地址都可访问。`port` 表示网站运行在哪个端口，默认是 `8000` 端口。



## 4 功能描述

本网站采用单页式的设计，从上到下依次是：

1. **主页：** 点击导航栏上的条目可以在不同的功能模块之间切换。

   ![1528207977701](http://p8lmnrxv7.bkt.clouddn.com/1528207977701.png)

2. **主功能页面：** 根据用户的选择的一些条件为用户决定一个结果。

   ![1528208076483](http://p8lmnrxv7.bkt.clouddn.com/1528208076483.png)

3. **猜你喜欢：** 展示一些条目。

   ![1528208258160](http://p8lmnrxv7.bkt.clouddn.com/1528208258160.png)

4. **添加数据：** 让用户可以自主添加数据。

   ![1528208408770](http://p8lmnrxv7.bkt.clouddn.com/1528208408770.png)



## 5 一些总结

由于本小组的两个人在之前 **完全没有 Web 开发的经验**， 对相关程序语言如 html，JavaScript 完全 **一窍不通**。而且选择 Django 也只是因为近阶段在学的东西需要用到 Python ，而之前也 **没有使用过 Django**。

所以几乎是边学边做，在做的过程中也踩了很多坑，遇到过很多问题，所以在此记录在开发过程中遇到的一些问题以及解决方法:dog: 。

1. **数据库模型的设计。**

   **描述：** 因为 `Django` 提供了 `ORM` 系统，所以数据库相关的操作不需要写 `SQL` 语句，而是使用一些接口函数，`Django` 会将其翻译成数据库语句进行操作。

   **解决方法：** 将一个数据库的表格写成一个类的形式，如

   ```python
   class Category(models.Model):
       name = models.CharField(max_length=100) 
   ```

   就创建了一个包含一个字段（还有一个隐式的 id 字段）的数据库表格。

   然后在命令行使用以下两条命令进行数据库的迁移。

   ```python
   python manage.py makemigrations		# 记录数据模型的变化
   python manage.py migrate			# 将变化写入数据库 
   ```

   

2. **网站不能通过外网访问。**

   **描述：**将网站挂在服务器上之后，按照文档运行了起来，发现只能在服务器本地才能访问，外网的机器无法访问。服务器使用的是公网 IP，理论上不存在不能访问到的问题。

   **解决方法：**通过网上查询的一些资料得知，要让外网访问，需要对配置文件做一些修改，具体地说，就是将项目中 `setting.py` 的 `ALLOWED_HOSTS` 设为 `['*',]`，即允许所有主机访问。

   

3. **动态刷新页面。**

   **描述：** 在用户选择条件，然后给出结果的模块中，需要动态的将数据显示在页面上，而不能刷新页面。

   **解决方法：**通过 `ajax` 在前端和后端之间传递数据可以使页面在不刷新的情况下就能重新渲染页面。

   

4. **JSON 文件解析。**

   **描述：** 使用 `ajax` 在前后端之间传递数据的时候，需要因为要将后端的数据传递给 `JavaScript` 脚本进行处理，所以传递的数据是 `JSON` 格式的，在脚本中调用方法对 `JSON` 对象进行解析时，一直都会抛出错误。 

   **解决方法：** 这个问题折腾了很久，但是网上的资料显示我并没有做错，最后是发现 `JSON` 对象竟然已经自己解析成字典了，所以再次进行解析就会出错。虽然问题解决了，但为什么会这样子还未知，我猜测可能是版本问题。

   

5. **静态文件加载。**

   **描述：** `css` 样式文件、 `JavaScripts` 脚本以及图片等静态文件的加载问题。 

   **解决方法：** 因为 `Django` 推荐采用模板标签的形式加载静态文件的，所以需要使用 `{% load staticfiles %} ` 引入模板，然后在代码中引用。

   

6. **Django 模板的应用。**

   **描述：** 前后端数据的交互需要用到模板。

   **解决方法：** 在加载页面的时候，将数据以字典的形式传给前端页面。前端处理的时候，就可以用 `Django` 独特的方式，将存储数据的变量渲染到前端。模板标签是以 `{% %}` 包裹的。

   

7. **Django 对外键的处理。**

   **描述：** 在用户添加数据的模块中，需要将数据写入数据库。但是外键的插入却一直都出错。

   **解决方法：** 通过查询资料得知外键的插入需要进行特殊处理，因为设计有一对多的外键和多对多的外键。最后的解决方法是先将非外键的值插入，然后再单独对外键进行赋值。

   

8. **From 表单提交不刷新页面。**

   **描述：** `html` 中，表单的提交会默认刷新页面，但是在一些功能中，并不想刷新页面。

   **解决方法：** 创建一个没有大小的 `iframe` 然后将 `from` 的 `target` 指向此 `iframe` 即可。

   